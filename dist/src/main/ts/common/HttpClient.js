"use strict";var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(exports, "__esModule", { value: true });exports.default = void 0;var _GenUtils = _interopRequireDefault(require("./GenUtils"));
var _LibraryUtils = _interopRequireDefault(require("./LibraryUtils"));
var _ThreadPool = _interopRequireDefault(require("./ThreadPool"));
var _promiseThrottle = _interopRequireDefault(require("promise-throttle"));
var _http = _interopRequireDefault(require("http"));
var _https = _interopRequireDefault(require("https"));
var _axios = _interopRequireDefault(require("axios"));

/**
 * Handle HTTP requests with a uniform interface.
 */
class HttpClient {

  static MAX_REQUESTS_PER_SECOND = 50;

  // default request config
  static DEFAULT_REQUEST = {
    method: "GET",
    resolveWithFullResponse: false,
    rejectUnauthorized: true
  };

  // rate limit requests per host
  static PROMISE_THROTTLES = [];
  static TASK_QUEUES = [];
  static DEFAULT_TIMEOUT = 60000;
  static MAX_TIMEOUT = 2147483647; // max 32-bit signed number




  /**
   * <p>Make a HTTP request.<p>
   * 
   * @param {object} request - configures the request to make
   * @param {string} request.method - HTTP method ("GET", "PUT", "POST", "DELETE", etc)
   * @param {string} request.uri - uri to request
   * @param {string|Uint8Array|object} request.body - request body
   * @param {string} [request.username] - username to authenticate the request (optional)
   * @param {string} [request.password] - password to authenticate the request (optional)
   * @param {object} [request.headers] - headers to add to the request (optional)
   * @param {boolean} [request.resolveWithFullResponse] - return full response if true, else body only (default false)
   * @param {boolean} [request.rejectUnauthorized] - whether or not to reject self-signed certificates (default true)
   * @param {number} request.timeout - maximum time allowed in milliseconds
   * @param {number} request.proxyToWorker - proxy request to worker thread
   * @return {object} response - the response object
   * @return {string|Uint8Array|object} response.body - the response body
   * @return {number} response.statusCode - the response code
   * @return {String} response.statusText - the response message
   * @return {object} response.headers - the response headers
   */
  static async request(request) {
    // proxy to worker if configured
    if (request.proxyToWorker) {
      try {
        return await _LibraryUtils.default.invokeWorker(undefined, "httpRequest", request);
      } catch (err) {
        if (err.message.length > 0 && err.message.charAt(0) === "{") {
          let parsed = JSON.parse(err.message);
          err.message = parsed.statusMessage;
          err.statusCode = parsed.statusCode;
        }
        throw err;
      }
    }

    // assign defaults
    request = Object.assign({}, HttpClient.DEFAULT_REQUEST, request);

    // validate request
    try {request.host = new URL(request.uri).host;} // hostname:port
    catch (err) {throw new Error("Invalid request URL: " + request.uri);}
    if (request.body && !(typeof request.body === "string" || typeof request.body === "object")) {
      throw new Error("Request body type is not string or object");
    }

    // initialize one task queue per host
    if (!HttpClient.TASK_QUEUES[request.host]) HttpClient.TASK_QUEUES[request.host] = new _ThreadPool.default(1);

    // initialize one promise throttle per host
    if (!HttpClient.PROMISE_THROTTLES[request.host]) {
      HttpClient.PROMISE_THROTTLES[request.host] = new _promiseThrottle.default({
        requestsPerSecond: HttpClient.MAX_REQUESTS_PER_SECOND, // TODO: HttpClient should not depend on MoneroUtils for configuration
        promiseImplementation: Promise
      });
    }

    // request using fetch or xhr with timeout
    let timeout = request.timeout === undefined ? HttpClient.DEFAULT_TIMEOUT : request.timeout === 0 ? HttpClient.MAX_TIMEOUT : request.timeout;
    let requestPromise = HttpClient.requestAxios(request);
    return _GenUtils.default.executeWithTimeout(requestPromise, timeout);
  }

  // ----------------------------- PRIVATE HELPERS ----------------------------


  /**
   * Get a singleton instance of an HTTP client to share.
   *
   * @return {http.Agent} a shared agent for network requests among library instances
   */
  static getHttpAgent() {
    if (!HttpClient.HTTP_AGENT) HttpClient.HTTP_AGENT = new _http.default.Agent({
      keepAlive: true,
      family: 4 // use IPv4
    });
    return HttpClient.HTTP_AGENT;
  }

  /**
   * Get a singleton instance of an HTTPS client to share.
   *
   * @return {https.Agent} a shared agent for network requests among library instances
   */
  static getHttpsAgent() {
    if (!HttpClient.HTTPS_AGENT) HttpClient.HTTPS_AGENT = new _https.default.Agent({
      keepAlive: true,
      family: 4 // use IPv4
    });
    return HttpClient.HTTPS_AGENT;
  }

  static async requestAxios(req) {
    if (req.headers) throw new Error("Custom headers not implemented in XHR request"); // TODO

    // collect params from request which change on await
    const method = req.method;
    const uri = req.uri;
    const host = req.host;
    const username = req.username;
    const password = req.password;
    const body = req.body;
    const isBinary = body instanceof Uint8Array;

    // queue and throttle requests to execute in serial and rate limited per host
    const resp = await HttpClient.TASK_QUEUES[host].submit(async function () {
      return HttpClient.PROMISE_THROTTLES[host].add(function () {
        return new Promise(function (resolve, reject) {
          HttpClient.axiosDigestAuthRequest(method, uri, username, password, body).then(function (resp) {
            resolve(resp);
          }).catch(function (error) {
            if (error.response?.status) resolve(error.response);
            reject(new Error("Request failed without response: " + method + " " + uri + " due to underlying error:\n" + error.message + "\n" + error.stack));
          });
        });

      }.bind(this));
    });

    // normalize response
    let normalizedResponse = {};
    normalizedResponse.statusCode = resp.status;
    normalizedResponse.statusText = resp.statusText;
    normalizedResponse.headers = { ...resp.headers };
    normalizedResponse.body = isBinary ? new Uint8Array(resp.data) : resp.data;
    if (normalizedResponse.body instanceof ArrayBuffer) normalizedResponse.body = new Uint8Array(normalizedResponse.body); // handle empty binary request
    return normalizedResponse;
  }

  static axiosDigestAuthRequest = async function (method, url, username, password, body) {
    if (typeof CryptoJS === 'undefined' && typeof require === 'function') {
      var CryptoJS = require('crypto-js');
    }

    const generateCnonce = function () {
      const characters = 'abcdef0123456789';
      let token = '';
      for (let i = 0; i < 16; i++) {
        const randNum = Math.round(Math.random() * characters.length);
        token += characters.slice(randNum, randNum + 1);
      }
      return token;
    };

    let count = 0;
    return _axios.default.request({
      url: url,
      method: method,
      timeout: this.timeout,
      headers: {
        'Content-Type': 'application/json'
      },
      responseType: body instanceof Uint8Array ? 'arraybuffer' : undefined,
      httpAgent: url.startsWith("https") ? undefined : HttpClient.getHttpAgent(),
      httpsAgent: url.startsWith("https") ? HttpClient.getHttpsAgent() : undefined,
      data: body,
      transformResponse: (res) => res,
      adapter: ['http', 'xhr', 'fetch']
    }).catch(async (err) => {
      if (err.response?.status === 401) {
        let authHeader = err.response.headers['www-authenticate'].replace(/,\sDigest.*/, "");
        if (!authHeader) {
          throw err;
        }

        // Digest qop="auth",algorithm=MD5,realm="monero-rpc",nonce="hBZ2rZIxElv4lqCRrUylXA==",stale=false
        const authHeaderMap = authHeader.replace("Digest ", "").replaceAll('"', "").split(",").reduce((prev, curr) => ({ ...prev, [curr.split("=")[0]]: curr.split("=").slice(1).join('=') }), {});

        ++count;

        const cnonce = generateCnonce();
        const HA1 = CryptoJS.MD5(username + ':' + authHeaderMap.realm + ':' + password).toString();
        const HA2 = CryptoJS.MD5(method + ':' + url).toString();

        const response = CryptoJS.MD5(HA1 + ':' +
        authHeaderMap.nonce + ':' +
        ('00000000' + count).slice(-8) + ':' +
        cnonce + ':' +
        authHeaderMap.qop + ':' +
        HA2).toString();
        const digestAuthHeader = 'Digest' + ' ' +
        'username="' + username + '", ' +
        'realm="' + authHeaderMap.realm + '", ' +
        'nonce="' + authHeaderMap.nonce + '", ' +
        'uri="' + url + '", ' +
        'response="' + response + '", ' +
        'opaque="' + (authHeaderMap.opaque ?? null) + '", ' +
        'qop=' + authHeaderMap.qop + ', ' +
        'nc=' + ('00000000' + count).slice(-8) + ', ' +
        'cnonce="' + cnonce + '"';

        const finalResponse = await _axios.default.request({
          url: url,
          method: method,
          timeout: this.timeout,
          headers: {
            'Authorization': digestAuthHeader,
            'Content-Type': 'application/json'
          },
          responseType: body instanceof Uint8Array ? 'arraybuffer' : undefined,
          httpAgent: url.startsWith("https") ? undefined : HttpClient.getHttpAgent(),
          httpsAgent: url.startsWith("https") ? HttpClient.getHttpsAgent() : undefined,
          data: body,
          transformResponse: (res) => res,
          adapter: ['http', 'xhr', 'fetch']
        });

        return finalResponse;
      }
      throw err;
    }).catch((err) => {
      throw err;
    });
  };
}exports.default = HttpClient;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfR2VuVXRpbHMiLCJfaW50ZXJvcFJlcXVpcmVEZWZhdWx0IiwicmVxdWlyZSIsIl9MaWJyYXJ5VXRpbHMiLCJfVGhyZWFkUG9vbCIsIl9wcm9taXNlVGhyb3R0bGUiLCJfaHR0cCIsIl9odHRwcyIsIl9heGlvcyIsIkh0dHBDbGllbnQiLCJNQVhfUkVRVUVTVFNfUEVSX1NFQ09ORCIsIkRFRkFVTFRfUkVRVUVTVCIsIm1ldGhvZCIsInJlc29sdmVXaXRoRnVsbFJlc3BvbnNlIiwicmVqZWN0VW5hdXRob3JpemVkIiwiUFJPTUlTRV9USFJPVFRMRVMiLCJUQVNLX1FVRVVFUyIsIkRFRkFVTFRfVElNRU9VVCIsIk1BWF9USU1FT1VUIiwicmVxdWVzdCIsInByb3h5VG9Xb3JrZXIiLCJMaWJyYXJ5VXRpbHMiLCJpbnZva2VXb3JrZXIiLCJ1bmRlZmluZWQiLCJlcnIiLCJtZXNzYWdlIiwibGVuZ3RoIiwiY2hhckF0IiwicGFyc2VkIiwiSlNPTiIsInBhcnNlIiwic3RhdHVzTWVzc2FnZSIsInN0YXR1c0NvZGUiLCJPYmplY3QiLCJhc3NpZ24iLCJob3N0IiwiVVJMIiwidXJpIiwiRXJyb3IiLCJib2R5IiwiVGhyZWFkUG9vbCIsIlByb21pc2VUaHJvdHRsZSIsInJlcXVlc3RzUGVyU2Vjb25kIiwicHJvbWlzZUltcGxlbWVudGF0aW9uIiwiUHJvbWlzZSIsInRpbWVvdXQiLCJyZXF1ZXN0UHJvbWlzZSIsInJlcXVlc3RBeGlvcyIsIkdlblV0aWxzIiwiZXhlY3V0ZVdpdGhUaW1lb3V0IiwiZ2V0SHR0cEFnZW50IiwiSFRUUF9BR0VOVCIsImh0dHAiLCJBZ2VudCIsImtlZXBBbGl2ZSIsImZhbWlseSIsImdldEh0dHBzQWdlbnQiLCJIVFRQU19BR0VOVCIsImh0dHBzIiwicmVxIiwiaGVhZGVycyIsInVzZXJuYW1lIiwicGFzc3dvcmQiLCJpc0JpbmFyeSIsIlVpbnQ4QXJyYXkiLCJyZXNwIiwic3VibWl0IiwiYWRkIiwicmVzb2x2ZSIsInJlamVjdCIsImF4aW9zRGlnZXN0QXV0aFJlcXVlc3QiLCJ0aGVuIiwiY2F0Y2giLCJlcnJvciIsInJlc3BvbnNlIiwic3RhdHVzIiwic3RhY2siLCJiaW5kIiwibm9ybWFsaXplZFJlc3BvbnNlIiwic3RhdHVzVGV4dCIsImRhdGEiLCJBcnJheUJ1ZmZlciIsInVybCIsIkNyeXB0b0pTIiwiZ2VuZXJhdGVDbm9uY2UiLCJjaGFyYWN0ZXJzIiwidG9rZW4iLCJpIiwicmFuZE51bSIsIk1hdGgiLCJyb3VuZCIsInJhbmRvbSIsInNsaWNlIiwiY291bnQiLCJheGlvcyIsInJlc3BvbnNlVHlwZSIsImh0dHBBZ2VudCIsInN0YXJ0c1dpdGgiLCJodHRwc0FnZW50IiwidHJhbnNmb3JtUmVzcG9uc2UiLCJyZXMiLCJhZGFwdGVyIiwiYXV0aEhlYWRlciIsInJlcGxhY2UiLCJhdXRoSGVhZGVyTWFwIiwicmVwbGFjZUFsbCIsInNwbGl0IiwicmVkdWNlIiwicHJldiIsImN1cnIiLCJqb2luIiwiY25vbmNlIiwiSEExIiwiTUQ1IiwicmVhbG0iLCJ0b1N0cmluZyIsIkhBMiIsIm5vbmNlIiwicW9wIiwiZGlnZXN0QXV0aEhlYWRlciIsIm9wYXF1ZSIsImZpbmFsUmVzcG9uc2UiLCJleHBvcnRzIiwiZGVmYXVsdCJdLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uL3NyYy9tYWluL3RzL2NvbW1vbi9IdHRwQ2xpZW50LnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBHZW5VdGlscyBmcm9tIFwiLi9HZW5VdGlsc1wiO1xuaW1wb3J0IExpYnJhcnlVdGlscyBmcm9tIFwiLi9MaWJyYXJ5VXRpbHNcIjtcbmltcG9ydCBUaHJlYWRQb29sIGZyb20gXCIuL1RocmVhZFBvb2xcIjtcbmltcG9ydCBQcm9taXNlVGhyb3R0bGUgZnJvbSBcInByb21pc2UtdGhyb3R0bGVcIjtcbmltcG9ydCBodHRwIGZyb20gXCJodHRwXCI7XG5pbXBvcnQgaHR0cHMgZnJvbSBcImh0dHBzXCI7XG5pbXBvcnQgYXhpb3MsIHsgQXhpb3NFcnJvciB9IGZyb20gXCJheGlvc1wiO1xuXG4vKipcbiAqIEhhbmRsZSBIVFRQIHJlcXVlc3RzIHdpdGggYSB1bmlmb3JtIGludGVyZmFjZS5cbiAqL1xuZXhwb3J0IGRlZmF1bHQgY2xhc3MgSHR0cENsaWVudCB7XG5cbiAgc3RhdGljIE1BWF9SRVFVRVNUU19QRVJfU0VDT05EID0gNTBcblxuICAvLyBkZWZhdWx0IHJlcXVlc3QgY29uZmlnXG4gIHByb3RlY3RlZCBzdGF0aWMgREVGQVVMVF9SRVFVRVNUID0ge1xuICAgIG1ldGhvZDogXCJHRVRcIixcbiAgICByZXNvbHZlV2l0aEZ1bGxSZXNwb25zZTogZmFsc2UsXG4gICAgcmVqZWN0VW5hdXRob3JpemVkOiB0cnVlXG4gIH1cblxuICAvLyByYXRlIGxpbWl0IHJlcXVlc3RzIHBlciBob3N0XG4gIHByb3RlY3RlZCBzdGF0aWMgUFJPTUlTRV9USFJPVFRMRVMgPSBbXTtcbiAgcHJvdGVjdGVkIHN0YXRpYyBUQVNLX1FVRVVFUyA9IFtdO1xuICBwcm90ZWN0ZWQgc3RhdGljIERFRkFVTFRfVElNRU9VVCA9IDYwMDAwO1xuICBzdGF0aWMgTUFYX1RJTUVPVVQgPSAyMTQ3NDgzNjQ3OyAvLyBtYXggMzItYml0IHNpZ25lZCBudW1iZXJcblxuICBwcm90ZWN0ZWQgc3RhdGljIEhUVFBfQUdFTlQ6IGFueTtcbiAgcHJvdGVjdGVkIHN0YXRpYyBIVFRQU19BR0VOVDogYW55O1xuXG4gIC8qKlxuICAgKiA8cD5NYWtlIGEgSFRUUCByZXF1ZXN0LjxwPlxuICAgKiBcbiAgICogQHBhcmFtIHtvYmplY3R9IHJlcXVlc3QgLSBjb25maWd1cmVzIHRoZSByZXF1ZXN0IHRvIG1ha2VcbiAgICogQHBhcmFtIHtzdHJpbmd9IHJlcXVlc3QubWV0aG9kIC0gSFRUUCBtZXRob2QgKFwiR0VUXCIsIFwiUFVUXCIsIFwiUE9TVFwiLCBcIkRFTEVURVwiLCBldGMpXG4gICAqIEBwYXJhbSB7c3RyaW5nfSByZXF1ZXN0LnVyaSAtIHVyaSB0byByZXF1ZXN0XG4gICAqIEBwYXJhbSB7c3RyaW5nfFVpbnQ4QXJyYXl8b2JqZWN0fSByZXF1ZXN0LmJvZHkgLSByZXF1ZXN0IGJvZHlcbiAgICogQHBhcmFtIHtzdHJpbmd9IFtyZXF1ZXN0LnVzZXJuYW1lXSAtIHVzZXJuYW1lIHRvIGF1dGhlbnRpY2F0ZSB0aGUgcmVxdWVzdCAob3B0aW9uYWwpXG4gICAqIEBwYXJhbSB7c3RyaW5nfSBbcmVxdWVzdC5wYXNzd29yZF0gLSBwYXNzd29yZCB0byBhdXRoZW50aWNhdGUgdGhlIHJlcXVlc3QgKG9wdGlvbmFsKVxuICAgKiBAcGFyYW0ge29iamVjdH0gW3JlcXVlc3QuaGVhZGVyc10gLSBoZWFkZXJzIHRvIGFkZCB0byB0aGUgcmVxdWVzdCAob3B0aW9uYWwpXG4gICAqIEBwYXJhbSB7Ym9vbGVhbn0gW3JlcXVlc3QucmVzb2x2ZVdpdGhGdWxsUmVzcG9uc2VdIC0gcmV0dXJuIGZ1bGwgcmVzcG9uc2UgaWYgdHJ1ZSwgZWxzZSBib2R5IG9ubHkgKGRlZmF1bHQgZmFsc2UpXG4gICAqIEBwYXJhbSB7Ym9vbGVhbn0gW3JlcXVlc3QucmVqZWN0VW5hdXRob3JpemVkXSAtIHdoZXRoZXIgb3Igbm90IHRvIHJlamVjdCBzZWxmLXNpZ25lZCBjZXJ0aWZpY2F0ZXMgKGRlZmF1bHQgdHJ1ZSlcbiAgICogQHBhcmFtIHtudW1iZXJ9IHJlcXVlc3QudGltZW91dCAtIG1heGltdW0gdGltZSBhbGxvd2VkIGluIG1pbGxpc2Vjb25kc1xuICAgKiBAcGFyYW0ge251bWJlcn0gcmVxdWVzdC5wcm94eVRvV29ya2VyIC0gcHJveHkgcmVxdWVzdCB0byB3b3JrZXIgdGhyZWFkXG4gICAqIEByZXR1cm4ge29iamVjdH0gcmVzcG9uc2UgLSB0aGUgcmVzcG9uc2Ugb2JqZWN0XG4gICAqIEByZXR1cm4ge3N0cmluZ3xVaW50OEFycmF5fG9iamVjdH0gcmVzcG9uc2UuYm9keSAtIHRoZSByZXNwb25zZSBib2R5XG4gICAqIEByZXR1cm4ge251bWJlcn0gcmVzcG9uc2Uuc3RhdHVzQ29kZSAtIHRoZSByZXNwb25zZSBjb2RlXG4gICAqIEByZXR1cm4ge1N0cmluZ30gcmVzcG9uc2Uuc3RhdHVzVGV4dCAtIHRoZSByZXNwb25zZSBtZXNzYWdlXG4gICAqIEByZXR1cm4ge29iamVjdH0gcmVzcG9uc2UuaGVhZGVycyAtIHRoZSByZXNwb25zZSBoZWFkZXJzXG4gICAqL1xuICBzdGF0aWMgYXN5bmMgcmVxdWVzdChyZXF1ZXN0KSB7XG4gICAgLy8gcHJveHkgdG8gd29ya2VyIGlmIGNvbmZpZ3VyZWRcbiAgICBpZiAocmVxdWVzdC5wcm94eVRvV29ya2VyKSB7XG4gICAgICB0cnkge1xuICAgICAgICByZXR1cm4gYXdhaXQgTGlicmFyeVV0aWxzLmludm9rZVdvcmtlcih1bmRlZmluZWQsIFwiaHR0cFJlcXVlc3RcIiwgcmVxdWVzdCk7XG4gICAgICB9IGNhdGNoIChlcnI6IGFueSkge1xuICAgICAgICBpZiAoZXJyLm1lc3NhZ2UubGVuZ3RoID4gMCAmJiBlcnIubWVzc2FnZS5jaGFyQXQoMCkgPT09IFwie1wiKSB7XG4gICAgICAgICAgbGV0IHBhcnNlZCA9IEpTT04ucGFyc2UoZXJyLm1lc3NhZ2UpO1xuICAgICAgICAgIGVyci5tZXNzYWdlID0gcGFyc2VkLnN0YXR1c01lc3NhZ2U7XG4gICAgICAgICAgZXJyLnN0YXR1c0NvZGUgPSBwYXJzZWQuc3RhdHVzQ29kZTtcbiAgICAgICAgfVxuICAgICAgICB0aHJvdyBlcnI7XG4gICAgICB9XG4gICAgfVxuXG4gICAgLy8gYXNzaWduIGRlZmF1bHRzXG4gICAgcmVxdWVzdCA9IE9iamVjdC5hc3NpZ24oe30sIEh0dHBDbGllbnQuREVGQVVMVF9SRVFVRVNULCByZXF1ZXN0KTtcblxuICAgIC8vIHZhbGlkYXRlIHJlcXVlc3RcbiAgICB0cnkgeyByZXF1ZXN0Lmhvc3QgPSBuZXcgVVJMKHJlcXVlc3QudXJpKS5ob3N0OyB9IC8vIGhvc3RuYW1lOnBvcnRcbiAgICBjYXRjaCAoZXJyKSB7IHRocm93IG5ldyBFcnJvcihcIkludmFsaWQgcmVxdWVzdCBVUkw6IFwiICsgcmVxdWVzdC51cmkpOyB9XG4gICAgaWYgKHJlcXVlc3QuYm9keSAmJiAhKHR5cGVvZiByZXF1ZXN0LmJvZHkgPT09IFwic3RyaW5nXCIgfHwgdHlwZW9mIHJlcXVlc3QuYm9keSA9PT0gXCJvYmplY3RcIikpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihcIlJlcXVlc3QgYm9keSB0eXBlIGlzIG5vdCBzdHJpbmcgb3Igb2JqZWN0XCIpO1xuICAgIH1cblxuICAgIC8vIGluaXRpYWxpemUgb25lIHRhc2sgcXVldWUgcGVyIGhvc3RcbiAgICBpZiAoIUh0dHBDbGllbnQuVEFTS19RVUVVRVNbcmVxdWVzdC5ob3N0XSkgSHR0cENsaWVudC5UQVNLX1FVRVVFU1tyZXF1ZXN0Lmhvc3RdID0gbmV3IFRocmVhZFBvb2woMSk7XG5cbiAgICAvLyBpbml0aWFsaXplIG9uZSBwcm9taXNlIHRocm90dGxlIHBlciBob3N0XG4gICAgaWYgKCFIdHRwQ2xpZW50LlBST01JU0VfVEhST1RUTEVTW3JlcXVlc3QuaG9zdF0pIHtcbiAgICAgIEh0dHBDbGllbnQuUFJPTUlTRV9USFJPVFRMRVNbcmVxdWVzdC5ob3N0XSA9IG5ldyBQcm9taXNlVGhyb3R0bGUoe1xuICAgICAgICByZXF1ZXN0c1BlclNlY29uZDogSHR0cENsaWVudC5NQVhfUkVRVUVTVFNfUEVSX1NFQ09ORCwgLy8gVE9ETzogSHR0cENsaWVudCBzaG91bGQgbm90IGRlcGVuZCBvbiBNb25lcm9VdGlscyBmb3IgY29uZmlndXJhdGlvblxuICAgICAgICBwcm9taXNlSW1wbGVtZW50YXRpb246IFByb21pc2VcbiAgICAgIH0pO1xuICAgIH1cblxuICAgIC8vIHJlcXVlc3QgdXNpbmcgZmV0Y2ggb3IgeGhyIHdpdGggdGltZW91dFxuICAgIGxldCB0aW1lb3V0ID0gcmVxdWVzdC50aW1lb3V0ID09PSB1bmRlZmluZWQgPyBIdHRwQ2xpZW50LkRFRkFVTFRfVElNRU9VVCA6IHJlcXVlc3QudGltZW91dCA9PT0gMCA/IEh0dHBDbGllbnQuTUFYX1RJTUVPVVQgOiByZXF1ZXN0LnRpbWVvdXQ7XG4gICAgbGV0IHJlcXVlc3RQcm9taXNlID0gSHR0cENsaWVudC5yZXF1ZXN0QXhpb3MocmVxdWVzdCk7XG4gICAgcmV0dXJuIEdlblV0aWxzLmV4ZWN1dGVXaXRoVGltZW91dChyZXF1ZXN0UHJvbWlzZSwgdGltZW91dCk7XG4gIH1cblxuICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSBQUklWQVRFIEhFTFBFUlMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuXG5cbiAgLyoqXG4gICAqIEdldCBhIHNpbmdsZXRvbiBpbnN0YW5jZSBvZiBhbiBIVFRQIGNsaWVudCB0byBzaGFyZS5cbiAgICpcbiAgICogQHJldHVybiB7aHR0cC5BZ2VudH0gYSBzaGFyZWQgYWdlbnQgZm9yIG5ldHdvcmsgcmVxdWVzdHMgYW1vbmcgbGlicmFyeSBpbnN0YW5jZXNcbiAgICovXG4gIHByb3RlY3RlZCBzdGF0aWMgZ2V0SHR0cEFnZW50KCkge1xuICAgIGlmICghSHR0cENsaWVudC5IVFRQX0FHRU5UKSBIdHRwQ2xpZW50LkhUVFBfQUdFTlQgPSBuZXcgaHR0cC5BZ2VudCh7XG4gICAgICBrZWVwQWxpdmU6IHRydWUsXG4gICAgICBmYW1pbHk6IDQgLy8gdXNlIElQdjRcbiAgICB9KTtcbiAgICByZXR1cm4gSHR0cENsaWVudC5IVFRQX0FHRU5UO1xuICB9XG5cbiAgLyoqXG4gICAqIEdldCBhIHNpbmdsZXRvbiBpbnN0YW5jZSBvZiBhbiBIVFRQUyBjbGllbnQgdG8gc2hhcmUuXG4gICAqXG4gICAqIEByZXR1cm4ge2h0dHBzLkFnZW50fSBhIHNoYXJlZCBhZ2VudCBmb3IgbmV0d29yayByZXF1ZXN0cyBhbW9uZyBsaWJyYXJ5IGluc3RhbmNlc1xuICAgKi9cbiAgcHJvdGVjdGVkIHN0YXRpYyBnZXRIdHRwc0FnZW50KCkge1xuICAgIGlmICghSHR0cENsaWVudC5IVFRQU19BR0VOVCkgSHR0cENsaWVudC5IVFRQU19BR0VOVCA9IG5ldyBodHRwcy5BZ2VudCh7XG4gICAgICBrZWVwQWxpdmU6IHRydWUsXG4gICAgICBmYW1pbHk6IDQgLy8gdXNlIElQdjRcbiAgICB9KTtcbiAgICByZXR1cm4gSHR0cENsaWVudC5IVFRQU19BR0VOVDtcbiAgfVxuXG4gIHByb3RlY3RlZCBzdGF0aWMgYXN5bmMgcmVxdWVzdEF4aW9zKHJlcSkge1xuICAgIGlmIChyZXEuaGVhZGVycykgdGhyb3cgbmV3IEVycm9yKFwiQ3VzdG9tIGhlYWRlcnMgbm90IGltcGxlbWVudGVkIGluIFhIUiByZXF1ZXN0XCIpOyAgLy8gVE9ET1xuXG4gICAgLy8gY29sbGVjdCBwYXJhbXMgZnJvbSByZXF1ZXN0IHdoaWNoIGNoYW5nZSBvbiBhd2FpdFxuICAgIGNvbnN0IG1ldGhvZCA9IHJlcS5tZXRob2Q7XG4gICAgY29uc3QgdXJpID0gcmVxLnVyaTtcbiAgICBjb25zdCBob3N0ID0gcmVxLmhvc3Q7XG4gICAgY29uc3QgdXNlcm5hbWUgPSByZXEudXNlcm5hbWU7XG4gICAgY29uc3QgcGFzc3dvcmQgPSByZXEucGFzc3dvcmQ7XG4gICAgY29uc3QgYm9keSA9IHJlcS5ib2R5O1xuICAgIGNvbnN0IGlzQmluYXJ5ID0gYm9keSBpbnN0YW5jZW9mIFVpbnQ4QXJyYXk7XG5cbiAgICAvLyBxdWV1ZSBhbmQgdGhyb3R0bGUgcmVxdWVzdHMgdG8gZXhlY3V0ZSBpbiBzZXJpYWwgYW5kIHJhdGUgbGltaXRlZCBwZXIgaG9zdFxuICAgIGNvbnN0IHJlc3AgPSBhd2FpdCBIdHRwQ2xpZW50LlRBU0tfUVVFVUVTW2hvc3RdLnN1Ym1pdChhc3luYyBmdW5jdGlvbigpIHtcbiAgICAgIHJldHVybiBIdHRwQ2xpZW50LlBST01JU0VfVEhST1RUTEVTW2hvc3RdLmFkZChmdW5jdGlvbigpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xuICAgICAgICAgIEh0dHBDbGllbnQuYXhpb3NEaWdlc3RBdXRoUmVxdWVzdChtZXRob2QsIHVyaSwgdXNlcm5hbWUsIHBhc3N3b3JkLCBib2R5KS50aGVuKGZ1bmN0aW9uKHJlc3ApIHtcbiAgICAgICAgICAgIHJlc29sdmUocmVzcCk7XG4gICAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24oZXJyb3I6IEF4aW9zRXJyb3IpIHtcbiAgICAgICAgICAgIGlmIChlcnJvci5yZXNwb25zZT8uc3RhdHVzKSByZXNvbHZlKGVycm9yLnJlc3BvbnNlKTtcbiAgICAgICAgICAgIHJlamVjdChuZXcgRXJyb3IoXCJSZXF1ZXN0IGZhaWxlZCB3aXRob3V0IHJlc3BvbnNlOiBcIiArIG1ldGhvZCArIFwiIFwiICsgdXJpICsgXCIgZHVlIHRvIHVuZGVybHlpbmcgZXJyb3I6XFxuXCIgKyBlcnJvci5tZXNzYWdlICsgXCJcXG5cIiArIGVycm9yLnN0YWNrKSk7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuXG4gICAgICB9LmJpbmQodGhpcykpO1xuICAgIH0pO1xuXG4gICAgLy8gbm9ybWFsaXplIHJlc3BvbnNlXG4gICAgbGV0IG5vcm1hbGl6ZWRSZXNwb25zZTogYW55ID0ge307XG4gICAgbm9ybWFsaXplZFJlc3BvbnNlLnN0YXR1c0NvZGUgPSByZXNwLnN0YXR1cztcbiAgICBub3JtYWxpemVkUmVzcG9uc2Uuc3RhdHVzVGV4dCA9IHJlc3Auc3RhdHVzVGV4dDtcbiAgICBub3JtYWxpemVkUmVzcG9uc2UuaGVhZGVycyA9IHsuLi5yZXNwLmhlYWRlcnN9O1xuICAgIG5vcm1hbGl6ZWRSZXNwb25zZS5ib2R5ID0gaXNCaW5hcnkgPyBuZXcgVWludDhBcnJheShyZXNwLmRhdGEpIDogcmVzcC5kYXRhO1xuICAgIGlmIChub3JtYWxpemVkUmVzcG9uc2UuYm9keSBpbnN0YW5jZW9mIEFycmF5QnVmZmVyKSBub3JtYWxpemVkUmVzcG9uc2UuYm9keSA9IG5ldyBVaW50OEFycmF5KG5vcm1hbGl6ZWRSZXNwb25zZS5ib2R5KTsgIC8vIGhhbmRsZSBlbXB0eSBiaW5hcnkgcmVxdWVzdFxuICAgIHJldHVybiBub3JtYWxpemVkUmVzcG9uc2U7XG4gIH1cblxuICBwcm90ZWN0ZWQgc3RhdGljIGF4aW9zRGlnZXN0QXV0aFJlcXVlc3QgPSBhc3luYyBmdW5jdGlvbihtZXRob2QsIHVybCwgdXNlcm5hbWUsIHBhc3N3b3JkLCBib2R5KSB7XG4gICAgaWYgKHR5cGVvZiBDcnlwdG9KUyA9PT0gJ3VuZGVmaW5lZCcgJiYgdHlwZW9mIHJlcXVpcmUgPT09ICdmdW5jdGlvbicpIHtcbiAgICAgIHZhciBDcnlwdG9KUyA9IHJlcXVpcmUoJ2NyeXB0by1qcycpO1xuICAgIH1cblxuICAgIGNvbnN0IGdlbmVyYXRlQ25vbmNlID0gZnVuY3Rpb24oKTogc3RyaW5nIHtcbiAgICAgIGNvbnN0IGNoYXJhY3RlcnMgPSAnYWJjZGVmMDEyMzQ1Njc4OSc7XG4gICAgICBsZXQgdG9rZW4gPSAnJztcbiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgMTY7IGkrKykge1xuICAgICAgICBjb25zdCByYW5kTnVtID0gTWF0aC5yb3VuZChNYXRoLnJhbmRvbSgpICogY2hhcmFjdGVycy5sZW5ndGgpO1xuICAgICAgICB0b2tlbiArPSBjaGFyYWN0ZXJzLnNsaWNlKHJhbmROdW0sIHJhbmROdW0rMSk7XG4gICAgICB9XG4gICAgICByZXR1cm4gdG9rZW47XG4gICAgfVxuXG4gICAgbGV0IGNvdW50ID0gMDtcbiAgICByZXR1cm4gYXhpb3MucmVxdWVzdCh7XG4gICAgICB1cmw6IHVybCxcbiAgICAgIG1ldGhvZDogbWV0aG9kLFxuICAgICAgdGltZW91dDogdGhpcy50aW1lb3V0LFxuICAgICAgaGVhZGVyczoge1xuICAgICAgICAnQ29udGVudC1UeXBlJzogJ2FwcGxpY2F0aW9uL2pzb24nXG4gICAgICB9LFxuICAgICAgcmVzcG9uc2VUeXBlOiBib2R5IGluc3RhbmNlb2YgVWludDhBcnJheSA/ICdhcnJheWJ1ZmZlcicgOiB1bmRlZmluZWQsXG4gICAgICBodHRwQWdlbnQ6IHVybC5zdGFydHNXaXRoKFwiaHR0cHNcIikgPyB1bmRlZmluZWQgOiBIdHRwQ2xpZW50LmdldEh0dHBBZ2VudCgpLFxuICAgICAgaHR0cHNBZ2VudDogdXJsLnN0YXJ0c1dpdGgoXCJodHRwc1wiKSA/IEh0dHBDbGllbnQuZ2V0SHR0cHNBZ2VudCgpIDogdW5kZWZpbmVkLFxuICAgICAgZGF0YTogYm9keSxcbiAgICAgIHRyYW5zZm9ybVJlc3BvbnNlOiByZXMgPT4gcmVzLFxuICAgICAgYWRhcHRlcjogWydodHRwJywgJ3hocicsICdmZXRjaCddLFxuICAgIH0pLmNhdGNoKGFzeW5jIChlcnIpID0+IHtcbiAgICAgIGlmIChlcnIucmVzcG9uc2U/LnN0YXR1cyA9PT0gNDAxKSB7XG4gICAgICAgIGxldCBhdXRoSGVhZGVyID0gZXJyLnJlc3BvbnNlLmhlYWRlcnNbJ3d3dy1hdXRoZW50aWNhdGUnXS5yZXBsYWNlKC8sXFxzRGlnZXN0LiovLCBcIlwiKTtcbiAgICAgICAgaWYgKCFhdXRoSGVhZGVyKSB7XG4gICAgICAgICAgdGhyb3cgZXJyO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gRGlnZXN0IHFvcD1cImF1dGhcIixhbGdvcml0aG09TUQ1LHJlYWxtPVwibW9uZXJvLXJwY1wiLG5vbmNlPVwiaEJaMnJaSXhFbHY0bHFDUnJVeWxYQT09XCIsc3RhbGU9ZmFsc2VcbiAgICAgICAgY29uc3QgYXV0aEhlYWRlck1hcCA9IGF1dGhIZWFkZXIucmVwbGFjZShcIkRpZ2VzdCBcIiwgXCJcIikucmVwbGFjZUFsbCgnXCInLCBcIlwiKS5zcGxpdChcIixcIikucmVkdWNlKChwcmV2LCBjdXJyKSA9PiAoey4uLnByZXYsIFtjdXJyLnNwbGl0KFwiPVwiKVswXV06IGN1cnIuc3BsaXQoXCI9XCIpLnNsaWNlKDEpLmpvaW4oJz0nKX0pLCB7fSlcblxuICAgICAgICArK2NvdW50O1xuXG4gICAgICAgIGNvbnN0IGNub25jZSA9IGdlbmVyYXRlQ25vbmNlKCk7XG4gICAgICAgIGNvbnN0IEhBMSA9IENyeXB0b0pTLk1ENSh1c2VybmFtZSsnOicrYXV0aEhlYWRlck1hcC5yZWFsbSsnOicrcGFzc3dvcmQpLnRvU3RyaW5nKCk7XG4gICAgICAgIGNvbnN0IEhBMiA9IENyeXB0b0pTLk1ENShtZXRob2QrJzonK3VybCkudG9TdHJpbmcoKTtcblxuICAgICAgICBjb25zdCByZXNwb25zZSA9IENyeXB0b0pTLk1ENShIQTErJzonK1xuICAgICAgICAgIGF1dGhIZWFkZXJNYXAubm9uY2UrJzonK1xuICAgICAgICAgICgnMDAwMDAwMDAnICsgY291bnQpLnNsaWNlKC04KSsnOicrXG4gICAgICAgICAgY25vbmNlKyc6JytcbiAgICAgICAgICBhdXRoSGVhZGVyTWFwLnFvcCsnOicrXG4gICAgICAgICAgSEEyKS50b1N0cmluZygpO1xuICAgICAgICBjb25zdCBkaWdlc3RBdXRoSGVhZGVyID0gJ0RpZ2VzdCcrJyAnK1xuICAgICAgICAgICd1c2VybmFtZT1cIicrdXNlcm5hbWUrJ1wiLCAnK1xuICAgICAgICAgICdyZWFsbT1cIicrYXV0aEhlYWRlck1hcC5yZWFsbSsnXCIsICcrXG4gICAgICAgICAgJ25vbmNlPVwiJythdXRoSGVhZGVyTWFwLm5vbmNlKydcIiwgJytcbiAgICAgICAgICAndXJpPVwiJyt1cmwrJ1wiLCAnK1xuICAgICAgICAgICdyZXNwb25zZT1cIicrcmVzcG9uc2UrJ1wiLCAnK1xuICAgICAgICAgICdvcGFxdWU9XCInKyhhdXRoSGVhZGVyTWFwLm9wYXF1ZSA/PyBudWxsKSsnXCIsICcrXG4gICAgICAgICAgJ3FvcD0nK2F1dGhIZWFkZXJNYXAucW9wKycsICcrXG4gICAgICAgICAgJ25jPScrKCcwMDAwMDAwMCcgKyBjb3VudCkuc2xpY2UoLTgpKycsICcrXG4gICAgICAgICAgJ2Nub25jZT1cIicrY25vbmNlKydcIic7XG5cbiAgICAgICAgY29uc3QgZmluYWxSZXNwb25zZSA9IGF3YWl0IGF4aW9zLnJlcXVlc3Qoe1xuICAgICAgICAgIHVybDogdXJsLFxuICAgICAgICAgIG1ldGhvZDogbWV0aG9kLFxuICAgICAgICAgIHRpbWVvdXQ6IHRoaXMudGltZW91dCxcbiAgICAgICAgICBoZWFkZXJzOiB7XG4gICAgICAgICAgICAnQXV0aG9yaXphdGlvbic6IGRpZ2VzdEF1dGhIZWFkZXIsXG4gICAgICAgICAgICAnQ29udGVudC1UeXBlJzogJ2FwcGxpY2F0aW9uL2pzb24nXG4gICAgICAgICAgfSxcbiAgICAgICAgICByZXNwb25zZVR5cGU6IGJvZHkgaW5zdGFuY2VvZiBVaW50OEFycmF5ID8gJ2FycmF5YnVmZmVyJyA6IHVuZGVmaW5lZCxcbiAgICAgICAgICBodHRwQWdlbnQ6IHVybC5zdGFydHNXaXRoKFwiaHR0cHNcIikgPyB1bmRlZmluZWQgOiBIdHRwQ2xpZW50LmdldEh0dHBBZ2VudCgpLFxuICAgICAgICAgIGh0dHBzQWdlbnQ6IHVybC5zdGFydHNXaXRoKFwiaHR0cHNcIikgPyBIdHRwQ2xpZW50LmdldEh0dHBzQWdlbnQoKSA6IHVuZGVmaW5lZCxcbiAgICAgICAgICBkYXRhOiBib2R5LFxuICAgICAgICAgIHRyYW5zZm9ybVJlc3BvbnNlOiByZXMgPT4gcmVzLFxuICAgICAgICAgIGFkYXB0ZXI6IFsnaHR0cCcsICd4aHInLCAnZmV0Y2gnXSxcbiAgICAgICAgfSk7XG5cbiAgICAgICAgcmV0dXJuIGZpbmFsUmVzcG9uc2U7XG4gICAgICB9XG4gICAgICB0aHJvdyBlcnI7XG4gICAgfSkuY2F0Y2goZXJyID0+IHtcbiAgICAgIHRocm93IGVycjtcbiAgICB9KTtcbiAgfVxufVxuIl0sIm1hcHBpbmdzIjoieUxBQUEsSUFBQUEsU0FBQSxHQUFBQyxzQkFBQSxDQUFBQyxPQUFBO0FBQ0EsSUFBQUMsYUFBQSxHQUFBRixzQkFBQSxDQUFBQyxPQUFBO0FBQ0EsSUFBQUUsV0FBQSxHQUFBSCxzQkFBQSxDQUFBQyxPQUFBO0FBQ0EsSUFBQUcsZ0JBQUEsR0FBQUosc0JBQUEsQ0FBQUMsT0FBQTtBQUNBLElBQUFJLEtBQUEsR0FBQUwsc0JBQUEsQ0FBQUMsT0FBQTtBQUNBLElBQUFLLE1BQUEsR0FBQU4sc0JBQUEsQ0FBQUMsT0FBQTtBQUNBLElBQUFNLE1BQUEsR0FBQVAsc0JB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